<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Azure Closed Captions</title>
    <link href="styles.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <h1>Closed Caption POC</h1>
    <div>
        Select video source: 
        <select id="selecturl" onchange="play();"></select> 
        <input type="checkbox" id="enableCC" value="Add CC Tracks" onclick="addRemoveCC();" checked="checked" /> Add CC Tracks
    <ul>
        <li>Caption file format: VTT</li>
        <li>Player: HTML5</li>
        <li>Caption displayed via <a href="http://www.w3.org/TR/2013/WD-ttml10-sdp-us-20130103/" target="_blank">SDP-US</a></li>
    </ul>
    </div>
    <div>
        <video autoplay loop controls id="vidID">
            <source type="video/mp4">
    HTML5 video not supported
        </video>
    </div>
<script>

    //.
    //v = document.getElementById("v")
    //v.textTracks[0].mode = "showing";  // "showing" will make them reappear
        // if you want to show the controls
    //v.controls = false;
    //.
        var data = [
                 {  
                    url: "https://cnewscctest.blob.core.windows.net/asset-a8642b01-3e7f-4c25-a70e-7fde7b133a66/0716_SatMo_morningrounds_replacement_1093560_740.mp4?sv=2012-02-12&sr=c&si=5a11e1a0-8779-4fc5-b53b-2b2db0e619b2&sig=gtnIQDm08RwXxnnZfrHcbVsn5ZT86aYizS353CSJvs4%3D&st=2016-09-09T21%3A44%3A45Z&se=2116-09-09T21%3A44%3A45Z",                                                                                     
                    text: "Saturday Morning Rounds", 
                    src: "Assets/SatMorningRounds.vtt",                                                                                 
                    id: "video1", 
                    label: "Closed Captions Generated by Azure Media Services Indexer", 
                    default: true 
                 },
                 { 
                    url: "https://cnewscctest.blob.core.windows.net/asset-6108eeaa-7e7b-413f-a7d0-235d99e27c78/CBSN_0804_MajorMobBustDMF_1102249_740.mp4?sv=2012-02-12&sr=c&si=a0fc68cc-b0b1-45b7-875f-851d22b05d1a&sig=O7pCZBSAoYpw%2BhYFbGjkvyLR0MNV3eZrwI6rR43XhbU%3D&st=2016-09-09T20%3A20%3A05Z&se=2116-09-09T20%3A20%3A05Z",                                                                                       
                    text: "CBSN - Major Mob Bust", 
                    src: "Assets/CBSN-MobBust.vtt",                                                                                   
                    id: "video2", 
                    label: "Closed Captions Generated by Azure Media Services Indexer", 
                    default: true 
                 },
                 { 
                    url: "https://cnewscctest.blob.core.windows.net/asset-f2f83af4-2598-4acf-ab53-5b78a50bd1ff/0804_CTM_Manafort_QandA_1102068_740.mp4?sv=2012-02-12&sr=c&si=e1bd7a6a-124d-4283-b4af-09eab6cd0d93&sig=69FNfQvSK2lKLKqSqzxcOEzm9ogix4dRLINolvbKfA0%3D&st=2016-09-09T20%3A28%3A45Z&se=2116-09-09T20%3A28%3A45Z",                                                                                       
                    text: "CTM Manafort Q and A", 
                    src: "Assets/CTM-Manafort-QA.vtt",                                                                                   
                    id: "video3", 
                    label: "Closed Captions Generated by Azure Media Services Indexer", 
                    default: true 
                 }
    ];

    loadSelect();
    play();

    function play() {
        var select = document.getElementById('selecturl');
        var sourceUrl = select.options[select.selectedIndex].value;
        if (sourceUrl.length > 5) {
            //set CC track
            addRemoveCC();
            
            var video = document.getElementById('vidID');
            video.src = sourceUrl;
            video.play();
        }
        else {
            window.alert("Select a valid media source URL.")
        }
    }

    function addRemoveCC()
    {
        var track;
        var video = document.getElementById("vidID");
        var checkbox = document.getElementById("enableCC");

        //clean CC track
        for (var i = 0; i < data.length; i++) {
            track = document.getElementById(data[i].id);
            if (track != null)
                video.removeChild(track);
        }

        //add selected CC track
        if (checkbox.checked)
        {
            var select = document.getElementById('selecturl');
            var sourceUrl = select.options[select.selectedIndex].value;

            for (var i = 0; i < data.length; i++) {
                if (data[i].url == sourceUrl) {
                    track = document.createElement("track");
                    track.src = data[i].src;
                    track.label = data[i].label;
                    track.default = data[i].default;
                    track.id = data[i].id;
                    video.appendChild(track);
                    break;
                }
            }
        }
    }

    function loadSelect() {
        var select = document.getElementById('selecturl');
        for (var i = 0; i < data.length; i++) {
            select.options[select.options.length] = new Option(data[i].text, data[i].url);
        }
    }
</script>
</body>
</html>
